<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope){
	var c = this;
	c.data.city = "Seattle";
	c.server.get({
		city: c.data.city
	}).then(function(response){
		c.weather = response.data.weather;
		
	})
	
};]]></client_script>
        <controller_as>c</controller_as>
        <css>.mainContainer {
  background:white;
  height:auto;  
  width: 100%;
  margin:10px;
  padding:5px;
  border-radius:5px;
  box-shadow: 1px 2px 15px gray;  
  text-align:center;
}

h4{
 color:black;
  font-weight:bold;
  font-size:16px;
  font-family:book antiqua; 
}

.weatherContainer {
  display: grid;
  grid-template-columns: repeat(8, 1fr);  
  background:white;
  height:auto;  
  overflow-y: scroll;
  width: 100%;
  font-size:16px;
  font-family:book antiqua; 
}

.days{
  color:black;
  padding: 2px;
  background-color: white;
  
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>hsc_weather</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>HSC Weather</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function(){

	if(input){
		/*  == CURRENT TEMPERATURE ======= */
		var city = input.city; 	
		var key = 'ede1a0b4e9b38045d1839a97e33d9c7a';
		var endpoint = 'http://api.openweathermap.org/data/2.5/weather?q=' + city + '&APPID=' + key;

		var request = new sn_ws.RESTMessageV2();
		request.setHttpMethod('GET');
		request.setEndpoint(endpoint);

		var response = request.execute();
		var responseBody = response.getBody();
		var parseResponseBody = JSON.parse(responseBody);

		var lat = parseResponseBody.coord.lat;
		var	lon = parseResponseBody.coord.lon;

		//2nd API call
		var latitude = lat;
		var longitude = lon;
		var apiKey = 'ede1a0b4e9b38045d1839a97e33d9c7a';
		var endPoint = "https://api.openweathermap.org/data/2.5/forecast?lat=" + latitude + "&lon=" + longitude + "&appid=" + apiKey;

		var request2 = new sn_ws.RESTMessageV2();
		request2.setHttpMethod('GET');
		request2.setEndpoint(endPoint);

		var response2 = request2.execute();
		var response2Body = response2.getBody();
		var parseResponse2Body =JSON.parse(response2Body);



		var forecastArray = [];	

		try{
			for(var i = 0; i < 8; i++){
				//Get the date & time, and split them.
				var dateTime = parseResponse2Body.list[i].dt_txt;
				var dateTimeSplit = dateTime.split(" ");

				var fullDate = dateTimeSplit[0];
				var daySlice = fullDate.slice(5);
				var day = daySlice;
				var firstDigit = daySlice.slice(0,1);				
				
				if(firstDigit == 0 ){
					day = daySlice.slice(1);
				}
					

				//
				var time='';
				var fullTime = dateTimeSplit[1];
        var hour = fullTime.slice(0,2);
				if(hour < 10 ){
					time = hour.slice(1);
				}
				
				if(hour < 12 ){
					time = time + 'am';
				}else if(hour == 12 ){
					time = '12pm';
				}else if(hour > 12 ){
					time = (hour - 12) + 'pm';
				}
				
				if(time == '0am'){
					time = '12am';
				}
				//Convert temp from Kelvin to Celsius to Ferenheit
				var kelvin = parseResponse2Body.list[0].main.temp;
				var celsius = parseInt(kelvin - 273.15);
				var ferenheit = parseInt(celsius * 9/5 + 32);

				var obj = {
					time: time,
					temp: ferenheit,
					desc: parseResponse2Body.list[i].weather[0].description,
					day: day,
					icon: parseResponse2Body.list[i].weather[0].icon
				}
				forecastArray.push(obj);				
			}

			//Load up the data object so it can pass the info to controller
			data.weather = forecastArray;
		}catch(error){
			data.error = error.message;
		}		

	}//End If(input)


})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-07-17 03:16:54</sys_created_on>
        <sys_id>7b643fbb47d302106c1f5ac5316d4339</sys_id>
        <sys_mod_count>332</sys_mod_count>
        <sys_name>HSC Weather</sys_name>
        <sys_package display_value="HSC Employee Center" source="x_1093559_hsc_em_0">2a4bbb98933c42105d94371efaba10a0</sys_package>
        <sys_policy/>
        <sys_scope display_value="HSC Employee Center">2a4bbb98933c42105d94371efaba10a0</sys_scope>
        <sys_update_name>sp_widget_7b643fbb47d302106c1f5ac5316d4339</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-07-19 02:51:18</sys_updated_on>
        <template><![CDATA[<div class="mainContainer" >
  <h4>Today's Weather</h4>
  <div class="weatherContainer" > 
    <div class="days"  ng-repeat="rec in c.weather" >																																			
      <img ng-src="http://openweathermap.org/img/wn/{{rec.icon}}.png" alt="Weather icon">
      <br/>
     
      {{rec.time}}
      <br/>
      {{rec.temp}}&deg; F
      <br/>
      {{rec.desc}}
    </div>
  </div> 
</div> 
]]></template>
    </sp_widget>
</record_update>
