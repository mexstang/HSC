<?xml version="1.0" encoding="UTF-8"?><record_update table="sc_cat_item_producer">
    <sc_cat_item_producer action="INSERT_OR_UPDATE">
        <access_type>restricted</access_type>
        <active>true</active>
        <allow_edit>false</allow_edit>
        <availability>on_desktop</availability>
        <billable>false</billable>
        <can_cancel>false</can_cancel>
        <category/>
        <checked_out>false</checked_out>
        <cost>0</cost>
        <custom_cart/>
        <delivery_plan display_value="DEFAULT">523da512c611228900811a37c97c2014</delivery_plan>
        <delivery_plan_script/>
        <delivery_time>1970-01-03 00:00:00</delivery_time>
        <description/>
        <display_price_property>non_zero</display_price_property>
        <entitlement_script/>
        <flow_designer_flow/>
        <fulfillment_automation_level>unspecified</fulfillment_automation_level>
        <group/>
        <hide_sp>false</hide_sp>
        <icon/>
        <ignore_price>true</ignore_price>
        <image/>
        <location/>
        <make_item_non_conversational>false</make_item_non_conversational>
        <mandatory_attachment>false</mandatory_attachment>
        <meta/>
        <mobile_hide_price>false</mobile_hide_price>
        <mobile_picture/>
        <mobile_picture_type>use_desktop_picture</mobile_picture_type>
        <model/>
        <name>HSC Time Clock</name>
        <no_attachment_v2>true</no_attachment_v2>
        <no_cart>false</no_cart>
        <no_cart_v2>false</no_cart_v2>
        <no_delivery_time_v2>false</no_delivery_time_v2>
        <no_order>false</no_order>
        <no_order_now>false</no_order_now>
        <no_proceed_checkout>false</no_proceed_checkout>
        <no_quantity>false</no_quantity>
        <no_quantity_v2>false</no_quantity_v2>
        <no_save_as_draft>true</no_save_as_draft>
        <no_search>false</no_search>
        <no_wishlist_v2>false</no_wishlist_v2>
        <omit_price>false</omit_price>
        <order>0</order>
        <ordered_item_link/>
        <owner display_value="admin">6816f79cc0a8016401c5a33be04be441</owner>
        <picture/>
        <post_insert_script><![CDATA[/**
* This script is executed after the record is generated. 
* `current` Is the GlideRecord produced by Record Producer. Use `current.update()` to update the record
* To access the variables, use `producer.var1` where var1 is the name of the variable
* To access the Record Producer use `cat_item`
*/]]></post_insert_script>
        <preview>JavaScript: popupOpenStandard("com.glideapp.servicecatalog_cat_item_view.do?v=1&amp;sysparm_id=0f70c9859749c21005d3b09ad053afa6&amp;sysparm_preview=true", "summary");</preview>
        <price>0</price>
        <published_ref/>
        <recurring_frequency/>
        <redirect_url>generated_record</redirect_url>
        <request_method/>
        <roles/>
        <save_options/>
        <save_script><![CDATA[/**
* This script is executed at every step save in Catalog Builder. 
* This script is executed before `Script` is executed.
* `current` Is the GlideRecord produced by Record Producer. 
* To access the variables, use `producer.var1` where var1 is the name of the variable
* To access the Record Producer use `cat_item`
*/]]></save_script>
        <sc_catalogs>e0d08b13c3330100c8b837659bba8fb4,742ce428d7211100f2d224837e61036d</sc_catalogs>
        <sc_ic_item_staging/>
        <sc_ic_version/>
        <sc_template/>
        <script><![CDATA[/** This script is executed before the Record is generated
 * `current`- GlideRecord produced by Record Producer
 * Don't use `current.update()` or `current.insert()` as the record is generated by Record Producer
 * Don't use `current.setValue('sys_class_name', 'xxx')` as this will trigger reparent flow and can cause data loss
 * Avoid `current.setAbortAction()` and generate a separate record
 * Use `producer.var1` to access variables
 */
(function() {
    //Check to make sure that user entered the correct logins. 

    var empName = producer.getDisplayValue('userid');
    var empID = producer.getValue('userid');
    var pss = producer.getValue('password');
	
	var grLogin = new GlideRecord('x_1093559_hsc_em_0_user_login');
	grLogin.addQuery('user_id',empName);
	grLogin.addQuery('current_password',pss);
	grLogin.query();


    if (grLogin.next()){
		gs.addErrorMessage("Success!!!!");
         
        //Workaround: Create a dateTime object and use the gs.nowDateTime() method 
		//to set it to the start of the day and end of day so you can get all records created on TODAY. 
		//Because the global gr.addQuery('sys_created_on','>=',dateTime) filter is not supported here. 
        var dateTime = new GlideDateTime();
        var currentDate = dateTime.getDisplayValue().split(' ')[0];

        var startOfDay = new GlideDateTime(currentDate + ' 00:00:00');
        var endOfDay = new GlideDateTime(currentDate + ' 23:59:59');


        //Get employee record, sort list by most current, retrieve 1st record only.
        //NEED: WHAT TO DO AT THE START OF THE DAY WHEN THERE ARE NO RECORDS YET???
        var empGr = new GlideRecord('x_1093559_hsc_em_0_hsc_attendance');
        empGr.addEncodedQuery('userid=' + empID + '^sys_created_onONToday@javascript:gs.beginningOfToday()@javascript:gs.endOfToday()');

        //empGr.addQuery('userid', empID);
        //empGr.addQuery('sys_created_on', '>=', startOfDay);
        //empGr.addQuery('sys_created_on', '<=', endOfDay);

        empGr.orderByDesc('sys_created_on');
        empGr.setLimit(1);
        empGr.query();

        //If a record is found, get the values of the timein/out fields and the current date/time.
        if (empGr.next()) {
            var timeIn = empGr.getValue('time_in');
            var timeOut = empGr.getValue('time_out');

            //Check to see which field is populated or empty & populate the empty field.
            if (timeIn !== '' && timeOut == '') {

                //current.setValue('time_out', dateTime);
                current.time_out = dateTime;

                gs.addInfoMessage('YOU HAVE SUCCESSFULLY CLOCKED OUT AT: ' + dateTime.getDisplayValue().split(' ')[1]);

            } else if (timeOut !== '' && timeIn == '') {

                //current.setValue('time_in', dateTime);
                current.time_in = dateTime;

                gs.addInfoMessage('YOU HAVE SUCCESSFULLY CLOCKED IN AT: ' + dateTime.getDisplayValue().split(' ')[1]);

            } else if (timeOut == '' && timeIn == '') {

                //current.setValue('time_in', dateTime);
                current.time_in = dateTime;

                gs.addInfoMessage('YOU HAVE SUCCESSFULLY CLOCKED IN AT: ' + dateTime.getDisplayValue().split(' ')[1]);
            }


        } else {
            current.time_in = dateTime;
            gs.addInfoMessage('NEW EMPLOYEE ADDED. YOU HAVE SUCCESSFULLY CLOCKED IN AT: ' + dateTime);
        }

        //https://docs.servicenow.com/bundle/washingtondc-servicenow-platform/page/product/service-catalog-management/concept/c_PopulatingRecordData.html

    } else {
        //current.setAbortAction(true);
        gs.addErrorMessage('Please make sure you entered the correct information.');

        producer.portal_redirect = "hscecportal?id=hsc_time_clock&sys_id=0f70c9859749c21005d3b09ad053afa6"

        current.userid = '';

        return false;
    } 

})();]]></script>
        <short_description>*If you forgot your password, click 'TIME CLOCK &gt; Reset Password' in the main menu above.</short_description>
        <show_variable_help_on_load>false</show_variable_help_on_load>
        <start_closed>false</start_closed>
        <state>published</state>
        <sys_class_name>sc_cat_item_producer</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-03-18 04:46:08</sys_created_on>
        <sys_id>0f70c9859749c21005d3b09ad053afa6</sys_id>
        <sys_mod_count>230</sys_mod_count>
        <sys_name>HSC Time Clock</sys_name>
        <sys_package display_value="HSC Employee Center" source="x_1093559_hsc_em_0">2a4bbb98933c42105d94371efaba10a0</sys_package>
        <sys_policy/>
        <sys_scope display_value="HSC Employee Center">2a4bbb98933c42105d94371efaba10a0</sys_scope>
        <sys_update_name>sc_cat_item_producer_0f70c9859749c21005d3b09ad053afa6</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-07-12 04:04:58</sys_updated_on>
        <table_name>x_1093559_hsc_em_0_hsc_attendance</table_name>
        <taxonomy_topic/>
        <template/>
        <template_manager_roles/>
        <type>item</type>
        <use_sc_layout>true</use_sc_layout>
        <vendor/>
        <version>341</version>
        <view/>
        <visible_bundle>true</visible_bundle>
        <visible_guide>true</visible_guide>
        <visible_standalone>true</visible_standalone>
        <workflow/>
    </sc_cat_item_producer>
    <sys_translated_text action="delete_multiple" query="documentkey=0f70c9859749c21005d3b09ad053afa6"/>
    <fx_price action="delete_multiple" query="id=0f70c9859749c21005d3b09ad053afa6"/>
    <fx_price action="INSERT_OR_UPDATE">
        <amount>0</amount>
        <currency display_value="USD">USD</currency>
        <field>price</field>
        <id>0f70c9859749c21005d3b09ad053afa6</id>
        <parent/>
        <reference_amount>0</reference_amount>
        <reference_currency display_value="USD">USD</reference_currency>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-03-18 04:46:08</sys_created_on>
        <sys_id>8f7005499749c21005d3b09ad053afb9</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-03-18 04:46:10</sys_updated_on>
        <table>sc_cat_item_producer</table>
        <type>calculated</type>
    </fx_price>
</record_update>
